/*!CK:2441300878!*//*1453440418,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ImUSH"]); }

__d("ChannelDefaults",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={LONGPOLL_TIMEOUT:60000,STALL_THRESHOLD:180000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:30000};},null);
__d('ChannelStateMap',[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();f.exports={pull:{ok:'pull!',error:'pull',error_missing:'pull',error_msg_type:'pull',clock_anomaly:'pull!',visible:'pull!',hidden:'idle!',refresh_0:'reconnect',refresh_110:'reconnect!',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},reconnect:{ok:'pull!',error:'reconnect',clock_anomaly:'reconnect!',visible:'pull!',hidden:'idle!'},idle:{ok:'idle!',clock_anomaly:'idle!',visible:'pull!',hidden:'idle!'},shutdown:{clock_anomaly:'shutdown!',visible:'shutdown!',hidden:'shutdown!'}};},null);
__d('RTISession',['getCrossOriginTransport','URI','XHRRequest','invariant','ErrorUtils','PHPQuerySerializer'],function a(b,c,d,e,f,g,h,i,j,k,l,m){'use strict';if(c.__markCompiled)c.__markCompiled();var n='.facebook.com';function o(p,q,r,s,t,u,v,w,x){!p?k(0):undefined;!s?k(0):undefined;!t?k(0):undefined;this.domain=p;this.port=q;this.edgePoolName=r;this.stickyToken=s;this.loggedInId=t;this.accountId=u;this.clientProfile=v||'desktop';this.clientId=w;this.capabilities=x;}o.prototype.issueRequest=function(p,q,r,s,t){!p?k(0):undefined;!q?k(0):undefined;!s?k(0):undefined;var u=this.domain.length-n.length,v=u>0&&this.domain.indexOf(n,u)!==-1,w=v?this.domain:this.domain+n,x=(1048576*Math.random()|0).toString(36),y={cb:x,sticky_token:this.stickyToken,uid:this.loggedInId,viewer_uid:this.accountId,sticky_pool:this.edgePoolName,profile:this.clientProfile,clientid:this.clientId,cap:this.capabilities};for(var z in y)!!q[z]?k(0):undefined;Object.assign(y,q);var aa=new i(p).setDomain(w).setPort(this.port).setSecure(new i(window.location.href).isSecure()).setQueryData(y),ba=r?'POST':'GET',ca={};new j(aa).setTransportBuilder(h.withCredentials).setTimeout(t?t*1000:30000).setMethod(ba).setDataSerializer(function(da){return m.serialize(JSON.stringify(da));}).setData(r).setRequestHeader('Content-Type','application/x-www-form-urlencoded').setResponseHandler((function(da){var ea=da.substring('for (;;);'.length);ca.data=JSON.parse(ea);ca.error=null;l.applyWithGuard(s,this,[ca]);}).bind(this)).setErrorHandler((function(da){ca.data=null;ca.error=da.errorMsg||'error';l.applyWithGuard(s,this,[ca]);}).bind(this)).send();};f.exports=o;},null);
__d('StateMachine',['setTimeoutAcrossTransitions','EventEmitter','ex'],function a(b,c,d,e,f,g,h,i,j){if(c.__markCompiled)c.__markCompiled();var k,l,m=0;function n(q,r){'use strict';this.idx=m++;this.machine=q;this.asap=r&&r.substr(-1)=='!';this.name=this.asap?r.substr(0,r.length-1):r;this.progress=p.NEW;this.status=null;}n.prototype.enter=function(){'use strict';this.machine.enter_private(this);};n.prototype.exit=function(q){'use strict';this.machine.exit_private(this,q);};n.prototype.toString=function(){'use strict';return this.name+'('+this.progress+','+this.status+')';};var o='_ABORT_';k=babelHelpers.inherits(p,i);l=k&&k.prototype;function p(q,r){'use strict';l.constructor.call(this);this.$StateMachine1=q;this.$StateMachine2=r;this.$StateMachine3=0;this.$StateMachine4=[];this.$StateMachine5=Date.now();}p.prototype.$StateMachine6=function(q){'use strict';this.$StateMachine4.push(Date.now()-this.$StateMachine5+': '+q);if(this.$StateMachine4.length>40)this.$StateMachine4=this.$StateMachine4.splice(-20);};p.prototype.getState=function(){'use strict';return this.$StateMachine7;};p.prototype.setDelay=function(q){'use strict';this.$StateMachine3=q||0;return this;};p.prototype.getDelay=function(){'use strict';return this.$StateMachine3;};p.prototype.enter=function(q){'use strict';this.enter_private(new n(this,q));};p.prototype.enter_private=function(q){'use strict';this.$StateMachine6('enter '+q+', '+this.$StateMachine7);if(this.$StateMachine7&&this.$StateMachine7!=q)this.$StateMachine7.exit(o);this.$StateMachine7=q;if(q.asap){delete q.asap;if(this.$StateMachine2.enter)this.$StateMachine2.enter(q);q.progress=p.ENTERED;}else{q.progress=p.PENDING;q.asap=true;q.$StateMachine8=h(function(){q.enter();},this.$StateMachine3);}this.emit(p.ENTER,q);};p.prototype.exit=function(q){'use strict';this.exit_private(this.$StateMachine7,q);};p.prototype.exit_private=function(q,r){'use strict';this.$StateMachine6('exit '+q+', '+r+', '+this.$StateMachine7);if(!q||q!=this.$StateMachine7)throw new Error(j('Invalid state: %s, history: %s',q,this.$StateMachine4.join('|')));if(q.progress==p.EXITED)return;q.status=r;q.progress=p.EXITED;if(q.$StateMachine8){clearInterval(q.$StateMachine8);q.$StateMachine8=null;}this.$StateMachine7=null;if(q&&this.$StateMachine2.exit)this.$StateMachine2.exit(q);q.exited=true;this.emit(p.EXIT,q);if(r!=o){var s=this.$StateMachine1[q.name];if(!s||!s[r])throw new Error(j('No exit for state:%s, status: %s',q.name,r));this.enter(s[r]);}};p.ENTER='enter';p.EXIT='exit';p.NEW='new';p.PENDING='pending';p.ENTERED='entered';p.EXITED='exited';f.exports=p;},null);
__d("rand32",[],function a(b,c,d,e,f,g){if(c.__markCompiled)c.__markCompiled();function h(){return Math.floor(Math.random()*4294967295);}f.exports=h;},null);
__d('MChannelManager',['Banzai','ChannelClientConfig','ChannelClientID','ChannelDefaults','ChannelEventEmitter','ChannelEventType','ChannelStateMap','Clock','LogHistory','MLogger','MRequest','MURI','RTISession','StateMachine','URI','Visibility','rand32','setTimeoutAcrossTransitions'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){if(c.__markCompiled)c.__markCompiled();var z,aa='ok',ba='error',ca='error_missing',da=60000,ea=null,fa=null,ga=null,ha=null,ia=null,ja=-1,ka=null,la=0,ma=j.getID(),na=false,oa={enter:function(ab){if(ha){ha.abort();ha=null;}switch(ab.name){case 'pull':if(!fa.uri)break;if(fa.disabled)break;var bb=new v(fa.uri),cb={channel:fa.user_channel,seq:ga,clientid:ma,profile:'mobile',partition:fa.partition,sticky_token:ja,msgs_recv:la,qp:'y',cb:x()};if(fa.chat_enabled)cb.state='active';if(ka)cb.sticky_pool=ka;if(fa.uid&&fa.viewerUid){cb.uid=fa.uid;cb.viewer_uid=fa.viewerUid;}ha=new r(bb+'').setCORS(true).setMethod('GET').setData(cb).setRaw(true);ha.listen('open',function(eb){eb.getTransport().withCredentials=true;});ha.listen('done',function(eb){ta(ab,eb);});ha.listen('error',function(){ta(ab);});break;case 'reconnect':var db=new s('/a/channel/reconnect.php');ha=new r(db+'').setMethod('GET');ha.listen('done',function(eb){ra(ab,eb);});ha.listen('error',function(eb){eb.isHandled=true;ra(ab);});break;default:}if(ha)ha.send();},exit:function(ab){if(ab.status==='ok'){if(ab.name==='pull')z.setDelay(0);}else if(!(ab.status==null)){var bb=z.getDelay();bb=bb>0?bb*2:ea.MIN_RETRY_INTERVAL;bb=Math.min(bb,ea.MAX_RETRY_INTERVAL);z.setDelay(bb);}if(ha){ha.abort();ha=null;}}};function pa(){var ab=null;if(na&&fa&&fa.host&&ja&&fa.uid)ab=new t(fa.host,null,ka,ja,fa.uid,fa.viewerUid,'mobile',ma,0);l.emit(m.RTI_SESSION,ab);}function qa(ab){ia=ab;}function ra(ab,bb){if(!bb){q.warn('_onReconnectError: reconnect request error');ab.exit(ba);}else if(bb.user_channel){fa=bb;ga=fa.seq;ab.exit(aa);}else{q.warn('_onReconnectError: bad reconnect response - %s',JSON.stringify(bb));ab.exit(ba);}}function sa(){na=true;pa();}function ta(ab,bb){var cb=aa;if(!bb){ab.exit(ba);return;}switch(bb.t){case 'refresh':case 'refreshDelay':cb='refresh_'+(bb.reason||0);break;case 'fullReload':cb=aa;if(bb.seq==0)sa();if('ms' in bb)ua(bb);break;case 'continue':break;case 'lb':var db=bb.lb_info;if(db){ja=db.sticky;var eb="http://";if(fa.is_secure_uri)eb="https://";if('pool' in db){ka=db.pool;}else{fa.uri=eb+db.vip+'.facebook.com/pull';fa.host=db.vip;}}else q.error('bad lb info from channel proxy');break;case 'msg':ua(bb);break;case 'batched':var fb=bb.batches,gb;for(gb=0;gb<fb.length;gb++)ta(ab,fb[gb]);break;case 'heartbeat':break;default:cb=ba;if(h.isEnabled('mchannel_detailed_log')){q.warn('_onRequestSuccess: invalid channel response, resending request: %s',JSON.stringify(bb));}else q.warn('_onRequestSuccess: invalid channel response, sending request again.');break;}if('seq' in bb)ga=bb.seq;ab.exit(cb);}function ua(ab){var bb=ab.seq-ab.ms.length;for(var cb=0;cb<ab.ms.length;cb++){var db=bb+cb;la++;if(db>=ga){if(ia)ab.ms[cb]=ia(ab.ms[cb]);if(ab.ms[cb].type==='skywalker'){l.emit(m.SKYWALKER_MESSAGE,ab.ms[cb]);}else if(ab.ms[cb].type==='qprimer'){sa();}else z.emit(z.CHANNEL_MESSAGE,ab.ms[cb]);}}}function va(){if(!z.xhrEnabled||ea)return;ea=Object.assign(k,i.config);fa=i.info;ga=fa.seq;o.addListener(o.ANOMALY,function(){z.exit('clock_anomaly');});w.addListener(w.HIDDEN,function(){z.exit('hidden');});w.addListener(w.VISIBLE,function(){z.exit('visible');});b.onbeforeunload=function(){if(ha)ha.abort();};if('sticky_token' in fa)ja=fa.sticky_token;wa();}function wa(){z.setDelay(ea.MIN_RETRY_INTERVAL);z.enter(fa.uri?'pull!':'reconnect!');}z=new u(n,oa);z.startChannel=va;z.setTransform=qa;z.xhrEnabled=!!b.XMLHttpRequest;z.CHANNEL_MESSAGE='channel_message';var xa;function ya(){z.emit(u.ENTER,{name:'stall',progress:u.ENTERED});if(h.isEnabled('mchannel_jumpstart'))wa();}function za(ab){p.getInstance('channel').log(ab.name,ab.status||ab.progress);if(ab.name!=='stall'){clearTimeout(xa);xa=y(ya,da);}}z.addListener(u.ENTER,za);z.addListener(u.EXIT,za);l.addListener(m.GET_RTI_SESSION_REQUEST,pa);f.exports=z;},null);
__d('MobileZeroRewriteURL',['MChannelManager'],function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();var i=null,j=null;function k(o){if(!o)return;i=o.regex_matcher;j=o.regex_replacer;for(var p=0;p<i.length;p++){var q=i[p];if(q.indexOf('^')===0)q=q.substr(1);var r=new RegExp(q,'i');i[p]=r;}h.setTransform(l);}function l(o){if(!i)return o;m(o);return o;}function m(o){if(!o)return;if(Array.isArray(o)){for(var p=0;p<o.length;p++)n(o,p);}else for(var q in o)if(o.hasOwnProperty(q))n(o,q);}function n(o,p){var q=o[p],r=typeof q;if(r==='object'){m(q);}else if(r==='string'&&q.indexOf('<img')>=0){q=q.replace(/<img[^>]*>/gi,function(s){for(var t=0;t<i.length;t++){var u=i[t];if(u.test(s))return s.replace(u,j[t]);}return s;});o[p]=q;}}g.main=k;},null);